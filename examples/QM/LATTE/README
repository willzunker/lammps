LATTE is a semi-empirical tight-binding quantum code, developed
primarily at Los Alamos National Labs.

See these links:

  https://www.osti.gov/biblio/1526907-los-alamos-transferable-tight-binding-energetics-latte-version
  https://github.com/lanl/LATTE

LAMMPS has 2 ways of working with LATTE:

(1) Via its LATTE package and the fix latte command
    must run LAMMPS on a single processor, it calls LATTE as a library

(2) Via its MDI package and the code-coupling MDI library
    (a) can run LAMMPS and LATTE as stand-alone codes
        LAMMPS can be run on any number of procs
        LATTE must run on a single proc, but can use OpenMP
    (b) can run LAMMPS with LATTE as a plug-in library
        must run LAMMPS on a single processor

Examples for use case (1) are in the examples/latte dir.  Use case (2)
is illustrated in this dir.

NOTE: If you compare MDI runs in this dir to similar fix latte runs in
examples/latte, the answers for energy and virial will be differnt.
This is b/c the version of LATTE used by the fix latte command within
the LATTE package is older than the version of LATTE used here which
now has MDI support.

------------------
Building 3 codes needed to run these examples

(1) Download and build MDI

% git clone git@github.com:MolSSI-MDI/MDI_Library.git mdi
% cd mdi
% mkdir build; cd build
% cmake ..           # includes support for all langauges (incl Fortran, Python)
% make

(2) Download and build LATTE with MDI support

% git clone git@github.com:lanl/LATTE.git latte
% cd latte
% cp makefiles/makefile.CHOICES.mdi makefile.CHOICES    # so can now edit
% edit makefile.CHOICES settings to have these settings:
  MAKELIB = OFF, SHARED = ON, MDI = ON
  MDI_PATH must point to CMake build of MDI in (1), 
    e.g. /home/sjplimp/mdi/build/MDI_Library
% make clean
% make        # creates liblatte.so and LATTE_DOUBLE with support for MDI

(3) Build LAMMPS with its MDI package
    also with the MOLECULE package for these example scripts
    NOTE: what about its LATTE package for fix latte command ?

Build with regular make:
% cd lammps/lib/mdi
% python Install.py -m mpi
% cd lammps/src
% make yes-mdi yes-molecule
% make mpi                     # creates lmp_mpi

Build with CMake:
% cd lammps
% mkdir build; cd build
% cmake -D PKG_MDI=yes -D PKG_MOLECULE=yes ../cmake
% make                         # creates lmp

(4) Copy LAMMPS and LATTE executables into this dir

Copy the LAMMPS executable into this dir as lmp_mpi.
Copy the LATTE executable LATTE_DOUBLE into this dir.
The run commands below assume you have done this.

(5) Insure LD_LIBRARY_PATH includes the dir where MDI was built in (1)
with its libmdi.so file, e.g. mdi/build/MDI_Library.  This is needed
so when LATTE_DOUBLE runs as an executable it will able to find
libmdi.so.

------------------
Notes on LATTE usage

By default LATTE reads the latte.in file for its parameters.  That
file specifies other files LATTE will read.  With MDI, the driver code
(e.g. LAMMPS) can use the >FNAME command to specify an alternate
filename to use instead of latte.in.

By default LATTE writes out a log.latte file with info about its
calculations.  An "OUTFILE= logfile" setting in latte.in can rename
this file.

This version of LATTE can only run on a single processor in an MPI
context.  However LATTE can use OpenMP for parallelism, so that it
effectively runs on more cores.  See instructions below for how to do
this.

---------
Run example #1: AIMD

* Run with MPI: 1 proc each

mpirun -np 1 lmp_mpi -mdi "-name LMP -role DRIVER -method MPI" \
  -in in.aimd.mdi -log log.aimd.mdi.lammps.1 : \
  -np 1 LATTE_DOUBLE -mdi "-name LATTE -role ENGINE -method MPI"

* Run with MPI: 2 procs for LAMMPS, 1 for LATTE

mpirun -np 2 lmp_mpi -mdi "-name LMP -role DRIVER -method MPI" \
  -in in.aimd.mdi -log log.aimd.mdi.lammps.2 : \
  -np 1 LATTE_DOUBLE -mdi "-name LATTE -role ENGINE -method MPI"

* Run in plugin mode: 1 proc

lmp_mpi -mdi \
  "-name LMP -role DRIVER -method LINK -plugin_path /home/sjplimp/latte/git" \
  -in in.aimd.mdi.plugin -log log.aimd.mdi.plugin.lammps.1

NOTE: The -plugin_path needs to point to where LATTE was built in step
(2).

---------
Run example #2: sequence of configurations

* Run with MPI: 1 proc each

mpirun -np 1 lmp_mpi -mdi "-name LMP -role DRIVER -method MPI" \
  -in in.series.mdi -log log.series.mdi.lammps.1 : \
  -np 1 LATTE_DOUBLE -mdi "-name LATTE -role ENGINE -method MPI"

* Run with MPI: 2 procs for LAMMPS, 1 for LATTE

mpirun -np 2 lmp_mpi -mdi "-name LMP -role DRIVER -method MPI" \
  -in in.series.mdi -log log.series.mdi.lammps.2 : \
  -np 1 LATTE_DOUBLE -mdi "-name LATTE -role ENGINE -method MPI"

* Run in plugin mode: 1 proc

lmp_mpi -mdi \
  "-name LMP -role DRIVER -method LINK -plugin_path /home/sjplimp/latte/git" \
   -in in.series.mdi.plugin -log log.series.mdi.plugin.1

NOTE: The -plugin_path needs to point to where LATTE was built in step
(2).
